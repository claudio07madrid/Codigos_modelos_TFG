clear all
close all
clc
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 load X
 X=dataX;
%%%%%%%%%%%%%%%
  load Y 
  Y=dataY;
   %%%%%%%%%%%% %%%%%%  
  Y=Y-mean(Y); %%%% IMPORTANTE  O CAMBIAR V(0)
  %%%%%% %%%%%% %%%%%% %%%%%% 
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
 chosen_output=2; %%%  1 or 2 %%% OUTPUT
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
    [dim1,dim2]=size(X);
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
 %%%%%%%%%%%% %%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%
   pos_antes=1:dim2; %%% all possible positions of variables
   todo_all_possible=1:dim2; %%% all possible positions of variables
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  % for i=1:dim2
       
 %%%%% %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%      
     for j=1:dim2
        %%%%%%%%%%%%%%%%%%%%%%%%%%% 
        %%%%%%%%%%%%%%%%%%%%%%%%%%% 
       if mod(j,10)==0
         disp([num2str(j/dim2*100),'%'])
       end
       %%%%%%%%%%%%%%%%%%%%%%%%%%% 
        %%%%%%%%%%%%%%%%%%%%%%%%%%%% 
         pos=pos_antes;
         pos(j)=[];
        Xnow=X(:,pos);
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         f=model(Xnow,Y(:,chosen_output),1);
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         alpha=10;
         error_par_aux(j)=mean(abs(Y(:,chosen_output)-f).^alpha);
     end
  %%%%% %%%%%  %%%%%  %%%%%  %%%%%  
  %%%%% %%%%%  %%%%%  %%%%%  %%%%% 
  %%%%% %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%% 
  %%%%% %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%% 
  %%%%% %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%%  %%%%% 
  disp('------------------------------------')
  disp('Solution / RANKING:') 
    er1=sort(error_par_aux,'descend'); 
  plot(error_par_aux)
     for j=1:dim2
         pos_fin(j)=find(error_par_aux==er1(j));
     end
     SOL=pos_fin   
  %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% 
  %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% 
  %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%     
   %%%%%%%%%%%%%%%%%%%%%%%  ERROR CONSIDERNADO LA SECUENCIA DECIDIDA %%%%
  for i=1:dim2
        Xnow2=X(:,pos_fin(1:i));
        f=model(Xnow2,Y(:,chosen_output),1);
        error_parOK(i)=mean(abs(Y(:,chosen_output)-f).^alpha);
     %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  end
    V=[mean(abs(Y(:,chosen_output)).^alpha) error_parOK];
     figure
    plot(0:dim2,V,'o-')
  
 
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   disp('------------------------------------------------')
   disp(['Recall chosen_output = ',num2str(chosen_output),' and alpha = ',num2str(alpha)])
   disp('------------------------------------------------')
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%
  %%%% STUDY FIRST DERIVATIVE AND CONVEXITY DO NOT STRICTLY REQUIRED
 % %figure
 % %stem(V(1:end-1)-V(2:end))
%   d1=V(1:end-1)-V(2:end);
%   posder1=find(d1<0);
%   length(posder1)
%   d2=d1(1:end-1)-d1(2:end);
%   posder2=find(d2<0);
%   length(posder2)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% output 1  %%%%%%%% %%%%%%%% %%%%%%%%  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%a=0.1%113   14     8   115   114    56    15    18    23    11    13    77    38   110    48    78  68
%a=0.5%113   14     8   115   114    56     4    43    13   107   117    11    23    55    38    77  46   
%a=1  %113   14     8   114   115    56     4    43    18    13   107    55    11    88    77    38   3
%a=2  %113   14     8   114   115     4    56    18    13    11   122    43   107   116    55   117  38
%a=3  %113   14     8   114   115     4    56    13    11    43   107    19   122   116    27    15  51
%a=5  %14     8   113   114   115    56    18     4   116    13    11   122    43   107    52    20  86
%a=6  %14     8   113   115   114    18     4   116    43   107    13    11   122   120     1    77  38
%a=10 % 8    14   113   115   114    18     4   116    43   122   120    13   107    11     1    46  77
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% output 2  %%%%%%%% %%%%%%%% %%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%a=0.1%114    1   113   110    15     9    79     3    62    94    49    47    31    70   101    12  14
%a=0.5%114    1   113    40    15    12    14   101    67    79    94    62    70     3    58    90  52
%a=1  %114    1   113   110     3    79    94    62    52    72    12    14    40    15    10   101  91
%a=2  %114    1   113     3   110    79    72    52    40    12    20    94    62    23    21    47  49
%a=3  %114  113     1     3   110    79    94    62    40    15     9    12    20    47    49   122  11
%a=4  %114  113     1   105   118    12    40    94    79    62    20    23    21     7    44    47  49
%a=5  %114  113     1    49    47    40    79    72    29   103   117   104   105    33    15     9 118
%a=6  %114  113     1   105   118    49    47     8    20    65    97    79    44     9    21    23   7
%a=10 %114   20    40    12    50     1     4   122    79    73    11     9   118     2     7   116  57
      